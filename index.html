<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- SEO Meta Tags -->
  <title>TalkOrDrink - Game B√†i Gen Z | Th·ª≠ Th√°ch & S·ª± Th·∫≠t Online</title>
  <meta name="description"
    content="Ch∆°i Talk Or Drink Online mi·ªÖn ph√≠! Game b√†i Drinking Game c·ª±c cu·ªën cho Gen Z: Check Var ng∆∞·ªùi y√™u c≈©, G√≥c ch·ªØa l√†nh, ƒê·∫°i h·ªôi Flex. Th·ª≠ th√°ch Truth or Dare vui nh·ªôn cho m·ªçi b·ªØa ti·ªác.">
  <meta name="keywords"
    content="talkordrink, talk or drink, drinking game online, game b√†i u·ªëng r∆∞·ª£u, truth or dare online, board game vi·ªát h√≥a, game check var, game gen z, game ti·ªác t√πng">
  <meta name="author" content="Antigravity">
  <link rel="canonical" href="https://talkordrink.surge.sh/">

  <!-- Open Graph / Facebook / Zalo -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://talkordrink.surge.sh/">
  <meta property="og:title" content="TalkOrDrink - Game B√†i Gen Z | Th·ª≠ Th√°ch & S·ª± Th·∫≠t Online">
  <meta property="og:description"
    content="Game b√†i Drinking Game c·ª±c cu·ªën cho Gen Z. Ch∆°i mi·ªÖn ph√≠ ngay tr√™n ƒëi·ªán tho·∫°i kh√¥ng c·∫ßn c√†i ƒë·∫∑t! üçª">
  <meta property="og:image"
    content="https://res.cloudinary.com/dkeupjars/image/upload/v1765720971/other_project/talkordrink-banner-03_gyssmx.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://talkordrink.surge.sh/">
  <meta property="twitter:title" content="TalkOrDrink - Game B√†i Gen Z | Th·ª≠ Th√°ch & S·ª± Th·∫≠t Online">
  <meta property="twitter:description" content="Ch∆°i Talk Or Drink Online mi·ªÖn ph√≠! Drinking Game c·ª±c cu·ªën cho Gen Z.">
  <meta property="twitter:image"
    content="https://res.cloudinary.com/dkeupjars/image/upload/v1765720971/other_project/talkordrink-banner-03_gyssmx.png">

  <!-- Favicon (using emoji as temporary favicon) -->
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçª</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;900&family=Pixelify+Sans:wght@400;500;600;700;900&display=swap"
    rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Html2Canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Canvas Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'y2k-pink': '#FF00FF',
            'y2k-green': '#00FF00',
            'y2k-blue': '#00FFFF',
            'y2k-yellow': '#FFFF00',
            'neon-purple': '#bc13fe',
          },
          fontFamily: {
            'sans': ['"Be Vietnam Pro"', 'sans-serif'],
            'pixel': ['"Pixelify Sans"', 'sans-serif'],
            'display': ['"Be Vietnam Pro"', 'sans-serif'],
          },
          boxShadow: {
            'retro': '4px 4px 0px 0px #000',
            'retro-sm': '2px 2px 0px 0px #000',
            'retro-lg': '8px 8px 0px 0px #000',
            'glow': '0 0 10px #FF00FF, 0 0 20px #FF00FF',
          },
          animation: {
            'bounce-slight': 'bounce-slight 2s infinite',
            'float': 'float 3s ease-in-out infinite',
            'slide-up': 'slideUp 0.5s ease-out forwards',
            'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            'bounce-slight': {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-5px)' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          }
        }
      }
    }
  </script>

  <style>
    body {
      font-family: 'Be Vietnam Pro', sans-serif;
      background-color: #f0f0f0;
      background-image:
        radial-gradient(#000 1px, transparent 1px),
        linear-gradient(to bottom right, #f0f0f0 0%, #e0e0e0 100%);
      background-size: 20px 20px, 100% 100%;
      overflow-x: hidden;
      overscroll-behavior-y: none;
    }

    /* Use pixel font only for very specific decorative elements if needed, otherwise default to readable font */
    .pixel-font {
      font-family: 'Be Vietnam Pro', sans-serif;
      /* Overriding pixel font class to use readable font as requested */
      letter-spacing: -0.02em;
    }

    /* Keep header logo as pixel if desired, creating a specific class for it */
    .brand-font {
      font-family: 'Pixelify Sans', sans-serif;
    }

    /* Animated Background Elements */
    .bg-shape {
      position: absolute;
      z-index: -1;
      opacity: 0.1;
      animation: float 6s infinite ease-in-out;
    }

    /* 3D Flip Card Styles */
    .perspective-1000 {
      perspective: 1000px;
    }

    .transform-style-3d {
      transform-style: preserve-3d;
    }

    .backface-hidden {
      backface-visibility: hidden;
    }

    .rotate-y-180 {
      transform: rotateY(180deg);
    }

    /* Hide Scrollbar */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* Custom Animations */
    .card-special {
      background-image: linear-gradient(135deg, #FF00FF 0%, #bc13fe 100%);
      color: white;
      text-shadow: 2px 2px 0px #000;
    }

    .card-special-icon {
      animation: spin 3s linear infinite;
    }

    @keyframes spin {
      100% {
        transform: rotate(360deg);
      }
    }

    .transition-screen {
      transition: transform 0.4s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.4s;
    }

    .fade-enter {
      opacity: 0;
      transform: scale(0.95);
    }

    .fade-enter-active {
      opacity: 1;
      transform: scale(1);
    }

    .fade-exit {
      opacity: 1;
      transform: scale(1);
    }

    .fade-exit-active {
      opacity: 0;
      transform: scale(1.05);
    }

    .pattern-grid {
      background-image: linear-gradient(0deg, transparent 24%, rgba(0, 0, 0, .3) 25%, rgba(0, 0, 0, .3) 26%, transparent 27%, transparent 74%, rgba(0, 0, 0, .3) 75%, rgba(0, 0, 0, .3) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(0, 0, 0, .3) 25%, rgba(0, 0, 0, .3) 26%, transparent 27%, transparent 74%, rgba(0, 0, 0, .3) 75%, rgba(0, 0, 0, .3) 76%, transparent 77%, transparent);
      background-size: 30px 30px;
    }

    /* Typography Polish */
    .text-glow {
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 0, 255, 0.5);
    }

    @keyframes float {
      0% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-5px);
      }

      100% {
        transform: translateY(0px);
      }
    }

    .animate-float {
      animation: float 3s ease-in-out infinite;
    }

    @keyframes popup-bounce {
      0% {
        transform: scale(0);
      }

      60% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }

    .popup-animate {
      animation: popup-bounce 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
  </style>
</head>

<body class="h-screen text-black select-none flex flex-col overflow-hidden relative">

  <!-- Background Shapes -->
  <div class="fixed top-10 left-[-20px] text-6xl text-y2k-pink opacity-20 animate-float" style="animation-delay: 0s;">‚òÖ
  </div>
  <div class="fixed bottom-20 right-[-10px] text-8xl text-y2k-blue opacity-20 animate-float"
    style="animation-delay: 1s;">‚óè</div>
  <div class="fixed top-1/2 left-10 text-4xl text-y2k-green opacity-20 animate-float" style="animation-delay: 2s;">‚ñ≤
  </div>

  <!-- Container -->
  <div id="app"
    class="w-full md:max-w-2xl mx-auto h-full relative bg-white/95 backdrop-blur-sm border-x-0 md:border-x-4 border-black box-border flex flex-col shadow-2xl overflow-hidden z-10">

    <!-- Header Marquee -->
    <div
      class="shrink-0 bg-y2k-blue border-b-4 border-black py-2 overflow-hidden whitespace-nowrap z-20 shadow-retro-sm">
      <div class="inline-block animate-[marquee_10s_linear_infinite]">
        <span class="pixel-font font-bold text-sm mx-4">‚òÖ TALK OR DRINK ‚òÖ</span>
        <span class="pixel-font font-bold text-sm mx-4">GEN Z EDITION</span>
        <span class="pixel-font font-bold text-sm mx-4">‚òÖ TALK OR DRINK ‚òÖ</span>
        <span class="pixel-font font-bold text-sm mx-4">NO ALCOHOL NO PARTY</span>
        <span class="pixel-font font-bold text-sm mx-4">‚òÖ TALK OR DRINK ‚òÖ</span>
      </div>
    </div>

    <!-- LANDING SCREEN -->
    <div id="landing-screen" class="flex-1 flex flex-col p-4 w-full h-full overflow-hidden transition-screen">
      <div class="text-center mb-4 mt-2 shrink-0">
        <h1
          class="pixel-font font-bold text-5xl leading-none text-y2k-pink drop-shadow-[4px_4px_0_rgba(0,0,0,1)] uppercase tracking-tighter hover:scale-105 transition-transform duration-300">
          Talk<br>Or<br>Drink
        </h1>
        <p
          class="mt-4 font-bold text-lg bg-y2k-green inline-block px-3 py-1 border-2 border-black shadow-retro-sm transform -rotate-2 pixel-font hover:rotate-0 transition-transform cursor-default">
          Ch·ªçn b·ªô b√†i ƒëi fen!
        </p>
      </div>

      <!-- Pack Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto pb-20 px-1 no-scrollbar flex-1" id="pack-grid">
        <!-- Dynamically populated -->
      </div>

      <footer class="mt-auto pt-4 pb-2 text-center text-xs opacity-50 shrink-0">
        coded by antigravity
      </footer>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen"
      class="hidden flex-1 flex flex-col p-4 w-full h-full relative overflow-hidden transition-screen opacity-0">

      <!-- Navbar -->
      <div class="flex justify-between items-center mb-4 shrink-0 z-20">
        <button onclick="goHome()"
          class="bg-gray-200 border-2 border-black px-3 py-1 shadow-retro-sm text-sm hover:bg-gray-300 active:translate-y-1 active:shadow-none font-bold pixel-font transition-colors">
          <i class="fa-solid fa-chevron-left mr-1"></i> MENU
        </button>
        <div class="pixel-font font-bold text-xs bg-black text-white px-3 py-1 uppercase tracking-wider shadow-retro-sm"
          id="pack-title-display">
          PACK NAME
        </div>
      </div>

      <!-- Card Showcase -->
      <div id="capture-area"
        class="flex-1 flex items-center justify-center mb-4 perspective-1000 relative w-full h-full min-h-0">
        <div id="flip-card"
          class="relative w-full h-full max-h-[60vh] aspect-[3/4] transition-all duration-700 transform-style-3d cursor-pointer"
          onclick="nextCard()">

          <!-- Front -->
          <div
            class="absolute inset-0 w-full h-full bg-y2k-pink border-4 border-black shadow-retro flex flex-col items-center justify-center backface-hidden z-10 pattern-grid group hover:bg-neon-purple transition-colors duration-300">
            <div
              class="border-4 border-black p-4 bg-white transform rotate-2 group-hover:rotate-0 transition-transform duration-300 shadow-retro-sm">
              <h2 class="pixel-font font-bold text-3xl text-center leading-tight header-glow">TALK<br>OR<br>DRINK</h2>
            </div>
            <p
              class="mt-6 font-bold bg-y2k-yellow border-2 border-black px-3 py-1 animate-pulse pixel-font text-sm shadow-retro-sm">
              CH·∫†M ƒê·ªÇ L·∫¨T</p>
          </div>

          <!-- Back -->
          <div id="card-back"
            class="absolute inset-0 w-full h-full bg-white border-4 border-black shadow-retro flex flex-col items-center justify-center backface-hidden rotate-y-180 p-6 z-0 overflow-hidden relative">
            <!-- Decorative Icons -->
            <div class="absolute top-2 left-2 text-y2k-pink opacity-50"><i class="fa-solid fa-star"></i></div>
            <div class="absolute top-2 right-2 text-y2k-pink opacity-50"><i class="fa-solid fa-star"></i></div>

            <!-- Content -->
            <div class="flex-1 flex items-center justify-center text-center w-full z-10">
              <p id="card-content"
                class="text-xl md:text-2xl lg:text-3xl font-bold leading-snug uppercase transform -rotate-1 break-words whitespace-pre-wrap max-h-full overflow-y-auto w-full no-scrollbar">
                <!-- Card Content Goes Here -->
              </p>
            </div>

            <!-- Special Effect Layer -->
            <div id="special-effect-layer" class="absolute inset-0 pointer-events-none hidden z-0">
              <!-- Gradient or pattern -->
            </div>

            <div
              class="absolute bottom-2 left-2 text-[10px] text-gray-500 pixel-font font-bold uppercase tracking-widest bg-gray-100 px-2 py-0.5 rounded border border-gray-300"
              id="deck-tag">
              <!-- Deck Name -->
            </div>

            <div class="absolute bottom-2 right-2 text-[10px] text-gray-400 pixel-font opacity-50">talkordrink.surge.sh
            </div>
          </div>
        </div>
      </div>

      <!-- Controls -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3 pb-2 shrink-0 z-20">
        <!-- Next Button (Middle Desktop) -->
        <div class="col-span-2 md:col-span-2 md:order-2">
          <button onclick="nextCard()"
            class="w-full bg-y2k-blue border-4 border-black shadow-retro py-3 pixel-font font-bold text-lg hover:brightness-110 active:translate-y-1 active:shadow-none transition-all group">
            TI·∫æP THEO <i class="fa-solid fa-forward ml-2 group-hover:translate-x-1 transition-transform"></i>
          </button>
        </div>
        <!-- Penalty (Left Desktop) -->
        <div class="col-span-1 md:col-span-1 md:order-1">
          <button onclick="triggerPenalty()"
            class="w-full bg-red-500 text-white border-4 border-black shadow-retro py-3 font-bold text-sm pixel-font hover:bg-red-600 active:translate-y-1 active:shadow-none transition-all uppercase h-full flex items-center justify-center">
            Th√¥i, U·ªëng! üç∫
          </button>
        </div>
        <!-- Share (Right Desktop) -->
        <div class="col-span-1 md:col-span-1 md:order-3">
          <button onclick="shareCard()"
            class="w-full bg-white border-4 border-black shadow-retro py-3 font-bold text-sm pixel-font hover:bg-gray-100 active:translate-y-1 active:shadow-none transition-all uppercase h-full flex items-center justify-center">
            Ch·ª•p l·∫°i üì∏
          </button>
        </div>
      </div>

    </div>

    <!-- Penalty Popup -->
    <div id="penalty-popup"
      class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"
      onclick="closePenalty()">
      <div
        class="bg-y2k-yellow border-4 border-black w-full max-w-xs p-6 shadow-retro-lg text-center popup-animate relative">
        <div class="absolute -top-6 -right-6 text-4xl animate-bounce">üíÄ</div>
        <h3 class="pixel-font text-xl mb-4">H√åNH PH·∫†T!</h3>
        <p id="penalty-text" class="text-4xl font-bold uppercase mb-6 leading-tight"></p>
        <button class="bg-black text-white pixel-font text-xs py-2 px-4 border-2 border-white shadow-retro-sm">
          CH·∫§P NH·∫¨N
        </button>
      </div>
    </div>

    <!-- Reshuffle/End Screen Overlay -->
    <div id="reshuffle-overlay"
      class="hidden fixed inset-0 z-40 bg-white/90 flex flex-col items-center justify-center p-8 text-center"
      style="display: none;">
      <h2 class="pixel-font text-2xl mb-4">H·∫æT B√ÄI R·ªíI!</h2>
      <p class="mb-8 text-xl">B·∫°n ƒë√£ ch∆°i h·∫øt b·ªô n√†y. Mu·ªën ch∆°i l·∫°i kh√¥ng?</p>
      <button onclick="resetCurrentDeck()"
        class="bg-y2k-green border-4 border-black shadow-retro px-6 py-3 pixel-font text-sm hover:scale-105 transition-transform">
        X√ÄO L·∫†I B√ÄI ‚Ü∫
      </button>
      <button onclick="goHome()" class="mt-4 text-sm underline hover:text-y2k-pink">
        ƒê·ªïi b·ªô kh√°c
      </button>
    </div>

  </div>

  <!-- Data & Logic -->
  <script>
    // --- STATE ---
    let decks = [];
    let currentDeckIndex = 0;
    let drawPile = []; // Array of indices [0, 1, 2...]
    let isFlipped = false;

    const penalties = [
      "1 NH·∫§P M√îI",
      "50% LY",
      "100% LY",
      "ƒê·ªíNG KH·ªûI (C·∫¢ B√ÄN)"
    ];

    // --- DOM ELEMENTS ---
    const landingScreen = document.getElementById('landing-screen');
    const packGrid = document.getElementById('pack-grid');
    const gameScreen = document.getElementById('game-screen');
    const packTitle = document.getElementById('pack-title-display');
    const cardElement = document.getElementById('flip-card');
    const cardBack = document.getElementById('card-back');
    const cardContent = document.getElementById('card-content');
    const penaltyPopup = document.getElementById('penalty-popup');
    const penaltyText = document.getElementById('penalty-text');
    const reshuffleOverlay = document.getElementById('reshuffle-overlay');

    // --- INIT & DATA LOADING ---
    async function initGame() {
      try {
        // Cache busting to ensure fresh data
        const response = await fetch(`data.json?v=${new Date().getTime()}`);
        if (!response.ok) throw new Error('Failed to load data');
        decks = await response.json();
        console.log("Loaded decks:", decks.map(d => d.name));
        renderPacks();
      } catch (error) {
        console.error(error);
        alert('Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu game. Vui l√≤ng ki·ªÉm tra l·∫°i k·∫øt n·ªëi ho·∫∑c file data.json!');
      }
    }

    function renderPacks() {
      packGrid.innerHTML = '';

      decks.forEach((deck, index) => {
        const btn = document.createElement('button');
        const hoverColorClass = `hover:bg-${deck.color}`;

        btn.className = `group active:translate-y-1 active:shadow-none transition-all relative w-full bg-white border-4 border-black shadow-retro p-4 flex items-center ${hoverColorClass} animate-slide-up opacity-0`;
        btn.style.animationDelay = `${index * 0.1}s`;

        // Explicitly bind the index
        btn.onclick = function () {
          console.log(`Clicked pack ${index}: ${deck.name}`);
          startGame(index);
        };

        btn.innerHTML = `
                    <div class="w-12 h-12 bg-black text-white flex items-center justify-center text-3xl mr-4 border-2 border-white group-hover:scale-110 group-hover:rotate-6 transition-transform duration-300 shadow-sm">
                        ${deck.icon}
                    </div>
                    <div class="text-left">
                        <h3 class="pixel-font text-sm mb-1 uppercase text-black font-bold group-hover:text-white group-hover:text-shadow-black transition-colors">${deck.name}</h3>
                        <p class="text-sm leading-tight text-gray-700 group-hover:text-black font-medium">${deck.description}</p>
                    </div>
                `;

        packGrid.appendChild(btn);
      });
    }

    // Initialize immediately
    initGame();

    // --- FUNCTIONS ---

    function startGame(deckIndex) {
      console.log(`Starting game with deck index: ${deckIndex}`);
      currentDeckIndex = deckIndex;
      packTitle.textContent = decks[deckIndex].name;

      // Transition
      landingScreen.classList.remove('fade-enter-active');
      landingScreen.classList.add('fade-exit-active');

      setTimeout(() => {
        landingScreen.classList.add('hidden');
        landingScreen.classList.remove('fade-exit-active');

        gameScreen.classList.remove('hidden');
        void gameScreen.offsetWidth;
        gameScreen.classList.remove('opacity-0');
        gameScreen.classList.add('fade-enter-active');

        resetCurrentDeck();
      }, 300);
    }

    function goHome() {
      gameScreen.classList.remove('fade-enter-active');
      gameScreen.classList.add('opacity-0');

      setTimeout(() => {
        gameScreen.classList.add('hidden');

        landingScreen.classList.remove('hidden');
        void landingScreen.offsetWidth;
        landingScreen.classList.add('fade-enter-active');

        reshuffleOverlay.style.display = 'none';
      }, 300);
    }

    function resetCurrentDeck() {
      reshuffleOverlay.style.display = 'none';
      drawPile = Array.from({ length: decks[currentDeckIndex].content.length }, (_, i) => i);
      shuffle(drawPile);

      isFlipped = false;
      cardElement.classList.remove('rotate-y-180');

      // Clear previous content to avoid confusion
      cardContent.innerText = "";
      resetCardStyle();

      // Update Deck Tag on Card Back
      const deckTag = document.getElementById('deck-tag');
      if (deckTag) {
        deckTag.innerText = decks[currentDeckIndex].name;
      }
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function resetCardStyle() {
      // Remove special styling
      cardBack.className = 'absolute inset-0 w-full h-full bg-white border-4 border-black shadow-retro flex flex-col items-center justify-center backface-hidden rotate-y-180 p-6 z-0 overflow-hidden relative';
      cardContent.className = 'text-xl md:text-2xl lg:text-3xl font-bold leading-snug uppercase transform -rotate-1 break-words whitespace-pre-wrap max-h-full overflow-y-auto w-full no-scrollbar';
    }

    function nextCard() {
      if (!isFlipped) {
        if (drawPile.length === 0) {
          reshuffleOverlay.style.display = 'flex';
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
          });
          return;
        }

        // Get content
        const cardIndex = drawPile.pop();
        const text = decks[currentDeckIndex].content[cardIndex];
        console.log(`Drawing card: ${text.substring(0, 20)}... from deck ${currentDeckIndex}`);

        cardContent.innerText = text;

        // DETECT SPECIAL CARDS
        const isSpecial = text.match(/^(L√Å B√ÄI|S·ªêC|TH·ª¨ TH√ÅCH|CHIA S·∫∫|TR√öNG TH∆Ø·ªûNG|S·ª∞ C·ªê|HO√ÅN ƒê·ªîI)/i);

        resetCardStyle();

        if (isSpecial) {
          setTimeout(() => { triggerSpecialEffect(); }, 200);
          cardBack.classList.remove('bg-white');
          cardBack.classList.add('card-special');
          cardContent.classList.add('text-glow');
        }

        cardElement.classList.add('rotate-y-180');
        isFlipped = true;
      } else {
        cardElement.classList.remove('rotate-y-180');
        isFlipped = false;
      }
    }

    function triggerSpecialEffect() {
      const count = 200;
      const defaults = { origin: { y: 0.7 } };
      function fire(particleRatio, opts) {
        confetti(Object.assign({}, defaults, opts, {
          particleCount: Math.floor(count * particleRatio)
        }));
      }
      fire(0.25, { spread: 26, startVelocity: 55, });
      fire(0.2, { spread: 60, });
      fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
      fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
      fire(0.1, { spread: 120, startVelocity: 45, });
    }

    function triggerPenalty() {
      const randomPenalty = penalties[Math.floor(Math.random() * penalties.length)];
      penaltyText.innerText = randomPenalty;
      penaltyPopup.classList.remove('hidden');
    }

    function closePenalty() {
      penaltyPopup.classList.add('hidden');
    }

    function shareCard() {
      if (!isFlipped) {
        alert("L·∫≠t b√†i l√™n tr∆∞·ªõc khi ch·ª•p nha fen!");
        return;
      }

      const currentText = cardContent.innerText;
      const currentDeck = decks[currentDeckIndex].name;
      // Check deck type or content for specific styling
      const isSpecial = currentText.match(/^(L√Å B√ÄI|S·ªêC|TH·ª¨ TH√ÅCH|CHIA S·∫∫|TR√öNG TH∆Ø·ªûNG|S·ª∞ C·ªê|HO√ÅN ƒê·ªîI)/i);

      // Colors mapping based on deck index
      const deckColors = ['#FFFF00', '#FF00FF', '#00FFFF', '#00FF00']; // yellow, pink, blue, green
      const mainColor = deckColors[currentDeckIndex] || '#FFFF00';

      // Create Wrapper
      const wrapper = document.createElement('div');
      wrapper.id = 'screenshot-wrapper';
      wrapper.style.position = 'fixed';
      wrapper.style.left = '-9999px';
      wrapper.style.top = '0';
      wrapper.style.width = '600px';
      wrapper.style.height = '1066px'; // 9:16 ratio for stories
      wrapper.style.zIndex = '-9999';
      wrapper.style.display = 'flex';
      wrapper.style.flexDirection = 'column';
      wrapper.style.alignItems = 'center';
      wrapper.style.justifyContent = 'space-between';
      wrapper.style.fontFamily = '"Be Vietnam Pro", sans-serif';
      wrapper.style.padding = '40px';
      wrapper.style.boxSizing = 'border-box';

      // Background
      if (isSpecial) {
        wrapper.style.background = "linear-gradient(180deg, #1a1a1a 0%, #2d002d 100%)";
        wrapper.style.color = "white";
      } else {
        // Retro grid paper look
        wrapper.style.backgroundColor = "#ffffff";
        wrapper.style.color = "black";
        wrapper.style.backgroundImage = `
                linear-gradient(to right, #f0f0f0 1px, transparent 1px),
                linear-gradient(to bottom, #f0f0f0 1px, transparent 1px)
             `;
        wrapper.style.backgroundSize = "40px 40px";
      }

      // Border frame
      const frameColor = isSpecial ? '#bc13fe' : 'black';
      const innerBorder = `
            position: absolute;
            top: 20px; left: 20px; right: 20px; bottom: 20px;
            border: 8px solid ${frameColor};
            pointer-events: none;
            z-index: 50;
        `;

      wrapper.innerHTML = `
            <div style="${innerBorder}"></div>
            
            <!-- Header -->
            <div style="z-index: 10; text-align: center; margin-top: 60px; display: flex; flex-direction: column; align-items: center;">
                <div style="font-family: 'Pixelify Sans', sans-serif; font-size: 60px; font-weight: 700; line-height: 1; text-transform: uppercase; margin-bottom: 30px; color: ${isSpecial ? '#ffffff' : '#000000'}; letter-spacing: 4px;">
                    TALK<span style="color: ${isSpecial ? '#FF00FF' : 'black'};">OR</span>DRINK
                </div>
                <!-- Deck Name Pill -->
                <div style="
                    display: inline-block;
                    background-color: ${isSpecial ? '#333333' : mainColor};
                    color: ${isSpecial ? '#ffffff' : '#000000'};
                    border: 3px solid #000000;
                    padding: 8px 32px;
                    font-size: 20px; 
                    font-weight: 800;
                    text-transform: uppercase;
                    border-radius: 100px;
                    letter-spacing: 1px;
                    line-height: normal;
                ">
                    ${currentDeck}
                </div>
            </div>

            <!-- Content -->
            <div style="flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; padding: 0 40px; text-align: center; z-index: 10;">
                <div style="font-family: 'Be Vietnam Pro', sans-serif; font-size: 52px; font-weight: 800; line-height: 1.35; overflow-wrap: break-word; color: ${isSpecial ? '#fff' : '#000'};">
                    ${currentText}
                </div>
            </div>

            <!-- Footer -->
            <div style="z-index: 10; margin-bottom: 50px; text-align: center;">
                <div style="font-size: 18px; opacity: 0.5; letter-spacing: 4px; font-weight: 700; text-transform: uppercase;">
                    talkordrink.surge.sh
                </div>
            </div>

            <!-- Decorations -->
            <div style="position: absolute; top: 35px; left: 35px; font-size: 50px; z-index: 5;">${isSpecial ? '‚ú®' : '‚≠ê'}</div>
            <div style="position: absolute; bottom: 35px; right: 35px; font-size: 50px; z-index: 5;">${isSpecial ? 'üíÄ' : 'üçª'}</div>
        `;

      document.body.appendChild(wrapper);

      // Capture
      html2canvas(wrapper, {
        useCORS: true,
        scale: 1, // Standard scale since we made element huge
        width: 600,
        height: 1066,
        backgroundColor: null
      }).then(canvas => {
        const image = canvas.toDataURL("image/png");
        const link = document.createElement('a');
        link.href = image;
        link.download = `talkordrink-story-${Date.now()}.png`;
        link.click();
        document.body.removeChild(wrapper);
      }).catch(err => {
        console.error("Screenshot failed:", err);
        alert("L·ªói ch·ª•p h√¨nh: " + err.message);
        if (document.body.contains(wrapper)) document.body.removeChild(wrapper);
      });
    }
  </script>
</body>

</html>